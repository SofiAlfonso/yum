<!-- Autor: Jhon Freddy Alzate -->

{% extends "core/base_admin.html" %}
{% load static %}
{% load i18n %}

{% block content %}
<div class="container mt-4">
  <div class="card shadow-sm">
    <div class="card-body">
      <!-- T√≠tulo -->
      <h2 class="card-title">{{ recipe.title }}</h2>
      <p class="text-muted">
        {% trans "Autor:" %} <strong>{{ recipe.user.username }}</strong> |
        {% trans "Categor√≠a:" %} <strong>{{ recipe.category }}</strong> |
        {% trans "Tiempo de preparaci√≥n:" %} <strong>{{ recipe.preparation_time }}</strong> |
        {% trans "Porciones:" %} <strong>{{ recipe.portions }}</strong>
      </p>

      <!-- Imagen -->
      {% if recipe.image %}
        <img src="{{ recipe.image }}" alt="{{ recipe.title }}" class="card-img-top mb-3">
      {% else %}
        <img src="{% static 'yum_users/recipe_img/default.png' %}" class="card-img-top recipe-img mb-3" alt="Receta">
      {% endif %}

      <!-- Descripci√≥n -->
      <p class="card-text">{{ recipe.description }}</p>

      <!-- Valores calculados -->
      <p><strong>{% trans "Valor nutricional (IA):" %}</strong> {{ recipe.nutritional_value }}/100</p>
      <p><strong>{% trans "Calificaci√≥n promedio:" %}</strong> 
        {% if avg_rating %}
          {{ avg_rating }}/5 ‚≠ê ({{ review_count }} {% trans "rese√±as" %})
        {% else %}
          {% trans "Sin calificaciones a√∫n" %}
        {% endif %}
      </p>

      <!-- Ingredientes -->
      <h4 class="mt-4">{% trans "Ingredientes" %}</h4>
      <ul>
        {% for ing in recipe.ingredients.all %}
          <li>{{ ing.quantity }} {{ ing.unit }} de {{ ing.ingredient_type.nombre }}</li>
        {% empty %}
          <li>{% trans "No se han agregado ingredientes." %}</li>
        {% endfor %}
      </ul>

      <!-- Instrucciones -->
        <h4 class="mt-4">{% trans "Instrucciones" %}</h4>
        <ol>
        {% for step in recipe.instructions.all %}
            <li>
            <strong>{% trans "Paso" %} {{ step.n_step }}:</strong> {{ step.title }}
            <p>{{ step.details }}</p>
            <small>{% trans "Complejidad:" %} {{ step.complexity }}/5</small>
            <!-- Botones admin para cada instrucci√≥n -->
            <div class="mt-1">
                <a href="{% url 'admin_instruction_edit' step.pk %}" class="btn btn-sm btn-warning">‚úèÔ∏è {% trans "Editar" %}</a>
                <a href="{% url 'admin_instruction_delete' step.pk %}" class="btn btn-sm btn-danger">üóë {% trans "Eliminar" %}</a>
            </div>
            </li>
        {% empty %}
            <p>{% trans "No se han agregado instrucciones." %}</p>
        {% endfor %}
        </ol>

        <!-- Bot√≥n para a√±adir nueva instrucci√≥n -->
        <div class="mt-3">
        <a href="{% url 'admin_instruction_add' recipe.id %}" class="btn btn-brand">‚ûï {% trans "A√±adir instrucci√≥n" %}</a>
        </div>


      <!-- Rese√±as -->
      <h4 class="mt-4">Rese√±as</h4>
      <ul class="list-group">
        {% for review in recipe.reviews.all %}
          <li class="list-group-item d-flex justify-content-between align-items-start">
            <div>
              <strong>{{ review.user.username }}</strong> {% trans "calific√≥:" %} {{ review.score }}/5 ‚≠ê
              <p>{{ review.comment }}</p>
            </div>
            <a href="{% url 'admin_review_delete' review.pk %}" class="btn btn-danger btn-sm">{% trans "Eliminar" %}</a>
          </li>
        {% empty %}
          <li class="list-group-item">{% trans "A√∫n no hay rese√±as." %}</li>
        {% endfor %}
      </ul>


      <!-- Acciones del admin -->
      <div class="mt-4 d-flex gap-2">
        <a href="{% url 'admin_recipe_edit' recipe.pk %}" class="btn btn-warning">{% trans "Editar" %}</a>
        <a href="{% url 'admin_recipe_delete' recipe.pk %}" class="btn btn-danger">{% trans "Eliminar" %}</a>
        <a href="{% url 'admin_recipe_list' %}" class="btn btn-secondary">{% trans "Volver a la lista" %}</a>
      </div>

    </div>
  </div>
</div>
{% endblock %}
