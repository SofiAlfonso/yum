{% extends "core/base_admin.html" %}

{% block content %}
<div class="container mt-4">
  <h2>Gestión de Usuarios</h2>

  <!-- Barra de búsqueda -->
  <form method="get" class="mb-3 d-flex gap-2">
    <input type="text" name="search" value="{{ request.GET.search }}" class="form-control" placeholder="Buscar usuario...">
    <select name="role" class="form-select">
      <option value="">Todos los roles</option>
      <option value="common" {% if request.GET.role == "common" %}selected{% endif %}>Usuario Común</option>
      <option value="admin" {% if request.GET.role == "admin" %}selected{% endif %}>Administrador</option>
    </select>
    <button type="submit" class="btn btn-brand">Filtrar</button>
  </form>

  <!-- Tabla de usuarios -->
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Usuario</th>
        <th>Email</th>
        <th>Recetas</th>
        <th>Reseñas</th>
        <th>Fecha de registro</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      <tr>
        <td>{{ user.username }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.recipe_count }}</td>
        <td>{{ user.review_count }}</td>
        <td>{{ user.date_joined|date:"d/m/Y" }}</td>
        <td>
          <a href="{% url 'admin_user_detail' user.pk %}" class="btn btn-sm btn-brand">Ver</a>
          <a href="{% url 'admin_user_delete' user.pk %}" class="btn btn-sm btn-danger">Eliminar</a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6">No se encontraron usuarios.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Paginación -->
  <nav>
    <ul class="pagination">
      {% if users.has_previous %}
        <li class="page-item"><a class="page-link" href="?page={{ users.previous_page_number }}">&laquo;</a></li>
      {% endif %}

      {% for num in users.paginator.page_range %}
        <li class="page-item {% if users.number == num %}active{% endif %}">
          <a class="page-link" href="?page={{ num }}">{{ num }}</a>
        </li>
      {% endfor %}

      {% if users.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ users.next_page_number }}">&raquo;</a></li>
      {% endif %}
    </ul>
  </nav>
</div>
{% endblock %}
