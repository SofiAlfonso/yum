<!-- Autor: Jhon Freddy Alzate -->
<!-- Mejorado por: Ana Sofia Alfonso -->

{% extends "core/base_admin.html" %}
{% load i18n %}

{% block content %}
<div class="container mt-4">
  <!-- Header con botÃ³n volver -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">{% trans "Detalle de Usuario" %}</h2>
    <a href="{% url 'admin_user_list' %}" class="btn btn-outline-secondary">
      â† {% trans "Volver" %}
    </a>
  </div>

  <!-- InformaciÃ³n principal del usuario -->
  <div class="card shadow-sm mb-4 dashboard-section-card">
    <div class="card-body p-4">
      <div class="row">
        <div class="col-md-2 text-center mb-3 mb-md-0">
          <div class="user-avatar-large mx-auto">
            {{ user_detail.username|slice:":1"|upper }}
          </div>
        </div>
        <div class="col-md-10">
          <h3 class="mb-3">{{ user_detail.username }}</h3>
          
          <div class="row g-3">
            <div class="col-md-6">
              <div class="info-item">
                <span class="info-label">ğŸ“§ {% trans "Email" %}</span>
                <span class="info-value">{{ user_detail.email }}</span>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="info-item">
                <span class="info-label">ğŸ‘¤ {% trans "Rol" %}</span>
                {% if user_detail.role == "admin" %}
                  <span class="badge bg-danger fs-6">ğŸ›¡ï¸ {% trans "Administrador" %}</span>
                {% else %}
                  <span class="badge bg-primary fs-6">ğŸ‘¤ {% trans "Usuario ComÃºn" %}</span>
                {% endif %}
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="info-item">
                <span class="info-label">ğŸ“… {% trans "Fecha de registro" %}</span>
                <span class="info-value">{{ user_detail.date_joined|date:"d/m/Y H:i" }}</span>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="info-item">
                <span class="info-label">ğŸ†” {% trans "ID de Usuario" %}</span>
                <span class="info-value">{{ user_detail.id }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- EstadÃ­sticas -->
  <div class="row g-4 mb-4">
    <div class="col-md-6">
      <div class="card shadow-sm stat-card stat-card-recipes">
        <div class="card-body text-center p-4">
          <div class="stat-icon">ğŸ“</div>
          <h3 class="stat-number">{{ recipe_count }}</h3>
          <p class="stat-label mb-0">{% trans "Recetas Publicadas" %}</p>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm stat-card stat-card-reviews">
        <div class="card-body text-center p-4">
          <div class="stat-icon">ğŸ’¬</div>
          <h3 class="stat-number">{{ review_count }}</h3>
          <p class="stat-label mb-0">{% trans "ReseÃ±as Escritas" %}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Recetas del usuario -->
  <div class="card shadow-sm mb-4 dashboard-section-card">
    <div class="card-header bg-white py-3">
      <h5 class="mb-0">ğŸ“ {% trans "Recetas de" %} {{ user_detail.username }}</h5>
    </div>
    <div class="card-body p-0">
      {% if user_recipes %}
        <div class="list-group list-group-flush">
          {% for recipe in user_recipes %}
            <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
              <div>
                <h6 class="mb-1">{{ recipe.title }}</h6>
                <small class="text-muted">
                  ğŸ“… {{ recipe.creation_date|date:"d/m/Y" }} â€¢ 
                  ğŸ’ª Valor nutricional: {{ recipe.nutritional_value }}
                </small>
              </div>
              <a href="{% url 'admin_recipe_detail' recipe.pk %}" class="btn btn-sm btn-outline-info">
                ğŸ‘ï¸ {% trans "Ver" %}
              </a>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center py-5 text-muted">
          <div class="empty-state-icon">ğŸ“</div>
          <p class="mb-0">{% trans "Este usuario no ha publicado recetas todavÃ­a." %}</p>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- ReseÃ±as del usuario -->
  <div class="card shadow-sm mb-4 dashboard-section-card">
    <div class="card-header bg-white py-3">
      <h5 class="mb-0">ğŸ’¬ {% trans "ReseÃ±as de" %} {{ user_detail.username }}</h5>
    </div>
    <div class="card-body p-0">
      {% if user_reviews %}
        <div class="list-group list-group-flush">
          {% for review in user_reviews %}
            <div class="list-group-item">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <div>
                  <h6 class="mb-1">{{ review.recipe.title }}</h6>
                  <div class="text-warning mb-1">
                    â­ <strong>{{ review.rating }}/5</strong>
                  </div>
                </div>
                <small class="text-muted">{{ review.creation_date|date:"d/m/Y" }}</small>
              </div>
              <p class="mb-0 text-muted">{{ review.comment }}</p>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center py-5 text-muted">
          <div class="empty-state-icon">ğŸ’¬</div>
          <p class="mb-0">{% trans "Este usuario no ha escrito reseÃ±as todavÃ­a." %}</p>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Botones de acciÃ³n -->
  <div class="d-flex gap-2 justify-content-end mb-4">
    <a href="{% url 'admin_user_list' %}" class="btn btn-outline-secondary btn-lg">
      â† {% trans "Volver a la lista" %}
    </a>
    <form action="{% url 'admin_user_delete' user_detail.pk %}" method="post" class="d-inline">
      {% csrf_token %}
      <button type="submit" class="btn btn-danger mt-3"
          onclick="return confirm('Â¿Seguro que quieres eliminar este usuario?')">
    {% trans "Eliminar" %}
      </button>
    </form>
  </div>
</div>
{% endblock %}